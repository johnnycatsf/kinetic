<script>
  var current_song = "5";
  var song_title = "Jump then Fall";
 
  $(document).ready(function(){
   var tempo = analyze_song();
   var spb = 1/tempo*60*4;

   $("#jplayer").bind($.jPlayer.event.timeupdate, function(event) { // Add a listener to report the time play began
         var time = Math.floor(event.jPlayer.status.currentTime*1)/1;
         $("#playBeganAtTime").text("Play began at time = " + time);
         if(time > spb) {
            add_word();
            tempo += tempo;
         }		   
         
	   });

	$("#jplayer").jPlayer({
		ready: function (event) {
		$(this).jPlayer("setMedia", {
	    m4a:"http://www.jplayer.org/audio/m4a/TSP-01-Cro_magnon_man.m4a",
	    oga:"http://www.jplayer.org/audio/ogg/TSP-01-Cro_magnon_man.ogg"
	   }).jPlayer("play");
	},
	swfPath: "../js",
	supplied: "m4a, oga",
	wmode: "window"
	});

	});
 
</script>
<script>
var poem = ["much","madness","is","divinest","sense","to","a","discerning","eye"]
var loc = 0

function makeHttpObject() {
  try {return new XMLHttpRequest();}
  catch (error) {}
  try {return new ActiveXObject("Msxml2.XMLHTTP");}
  catch (error) {}
  try {return new ActiveXObject("Microsoft.XMLHTTP");}
  catch (error) {}

  throw new Error("Could not create HTTP request object.");
}


function analyze_song() {
   var request = makeHttpObject();
   request.open("GET", "http://developer.echonest.com/api/v4/track/profile?api_key=CJMTSEJKZGMYYF9UI&format=json&id=TRXXHTJ1294CD8F3B3&bucket=audio_summary", false);
   request.send(null);
   //alert(request.responseText);
   $("#response").html(request.responseText);
   var myObject = eval('(' + request.responseText + ')');
   return parseInt(myObject.response.track.audio_summary.tempo);
}  

function add_word() {
   word = poem[loc]
   loc = loc + 1
   $("#poem").html($("#poem").html()+" "+word)
}

</script>

<div id="poem"> </div>
<button onclick="add_word()">add word</button>
<button onclick="analyze_song()">analyze song</button>
<div id="playBeganAtTime"></div>

<div id="jquery_jplayer_1" class="jp-jplayer"></div>
<div id="jp_container_1" class="jp-audio">
<div class="jp-type-single">
<div class="jp-gui jp-interface">
<ul class="jp-controls">
<li><a href="javascript:;" class="jp-play" tabindex="1">play</a></li>

	<li><a href="javascript:;" class="jp-pause" tabindex="1">pause</a></li>
	<li><a href="javascript:;" class="jp-stop" tabindex="1">stop</a></li>
	<li><a href="javascript:;" class="jp-mute" tabindex="1" title="mute">mute</a></li>
	<li><a href="javascript:;" class="jp-unmute" tabindex="1" title="unmute">unmute</a></li>
	<li><a href="javascript:;" class="jp-volume-max" tabindex="1" title="max volume">max volume</a></li>
</ul>

<div class="jp-progress">
	<div class="jp-seek-bar">
		<div class="jp-play-bar"></div>
	</div>
</div>
<div class="jp-volume-bar">
	<div class="jp-volume-bar-value"></div>
</div>
<div class="jp-time-holder">

	<div class="jp-current-time"></div>
	<div class="jp-duration"></div>

	<ul class="jp-toggles">
		<li><a href="javascript:;" class="jp-repeat" tabindex="1" title="repeat">repeat</a></li>
		<li><a href="javascript:;" class="jp-repeat-off" tabindex="1" title="repeat off">repeat off</a></li>
	</ul>
</div>

</div>
<div class="jp-no-solution">
<span>Update Required</span>

To play the media you will need to either update your browser to a recent version or update your <a href="http://get.adobe.com/flashplayer/" target="_blank">Flash plugin</a>.
</div>
</div>
</div>

<div id="response"></div>
